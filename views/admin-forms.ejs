<%- include('partials/header', { pageTitle, activePage }) %>

<section style="padding: 2rem 1.5rem;">
  <header class="page-header">
    <div>
      <h1 class="page-title">Form Submissions</h1>
      <p class="page-subtitle">
        Contact form submissions collected from all configured sites.
      </p>
    </div>
  </header>

  <form method="get" action="/admin/forms" style="margin-bottom: 1rem;">
    <div class="form-group" style="max-width: 320px;">
      <label for="domain">Filter by domain (optional)</label>
      <input id="domain" name="domain" value="<%= domainFilter %>" placeholder="e.g. localhost">
    </div>
    <button type="submit" class="btn">Apply Filter</button>
  </form>

  <% if (!submissions || submissions.length === 0) { %>
    <p>No submissions found.</p>
  <% } else { %>
    <div style="overflow-x:auto;">
      <table style="width:100%; border-collapse: collapse; font-size: 0.9rem;">
        <thead>
          <tr style="background:#f3f3f3;">
            <th style="border:1px solid #ddd; padding:0.4rem;">ID</th>
            <th style="border:1px solid #ddd; padding:0.4rem;">Domain</th>
            <th style="border:1px solid #ddd; padding:0.4rem;">Name</th>
            <th style="border:1px solid #ddd; padding:0.4rem;">Email</th>
            <th style="border:1px solid #ddd; padding:0.4rem;">Phone</th>
            <th style="border:1px solid #ddd; padding:0.4rem;">SMS Consent</th>
            <th style="border:1px solid #ddd; padding:0.4rem;">Message</th>
            <th style="border:1px solid #ddd; padding:0.4rem;">Created At</th>
          </tr>
        </thead>
        <tbody>
          <% submissions.forEach(function(s) { %>
            <tr>
              <td style="border:1px solid #eee; padding:0.4rem; white-space:nowrap;">
                <%= s.id %>
              </td>
              <td style="border:1px solid #eee; padding:0.4rem; white-space:nowrap;">
                <%= s.site_domain %>
              </td>
              <td style="border:1px solid #eee; padding:0.4rem; white-space:nowrap;">
                <%= s.name %>
              </td>
              <td style="border:1px solid #eee; padding:0.4rem; white-space:nowrap;">
                <a href="mailto:<%= s.email %>"><%= s.email %></a>
              </td>
              <td style="border:1px solid #eee; padding:0.4rem; white-space:nowrap;">
                <%= s.phone || '' %>
              </td>
              <td style="border:1px solid #eee; padding:0.4rem; white-space:nowrap;">
                <%= s.sms_consent ? 'YES' : 'NO' %>
              </td>
              <td style="border:1px solid #eee; padding:0.4rem; max-width: 320px; word-wrap: break-word; white-space:normal;">
                <%= s.message %>
              </td>
              <td style="border:1px solid #eee; padding:0.4rem; white-space:nowrap;">
                <%= (s.created_at || '').slice(0, 16) %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } %>
</section>

<%- include('partials/footer') %>
